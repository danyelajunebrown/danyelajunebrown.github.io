<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herb Map</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Clock } = lucide;

        const TEPHRA_LAT = 38.9586;
        const TEPHRA_LNG = -77.3570;
        const MILES_TO_PIXELS = 100;

        // Create a systematic distribution of coordinates in a spiral pattern
        const generateCoordinates = (centerLat, centerLng, radiusMiles, count) => {
            const coordinates = [];
            for (let i = 0; i < count; i++) {
                const angle = (i / count) * 2 * Math.PI;
                const radius = (radiusMiles * (i + 1)) / count;
                const lat = centerLat + (radius / 69) * Math.cos(angle);
                const lng = centerLng + (radius / (69 * Math.cos(centerLat * Math.PI / 180))) * Math.sin(angle);
                coordinates.push({ lat, lng });
            }
            return coordinates;
        };

        // Generate positions for all herbs
        const positions = generateCoordinates(TEPHRA_LAT, TEPHRA_LNG, 4.5, 20);

        // Convert lat/lng to x,y coordinates relative to Tephra ICA
        const convertToXY = (lat, lng) => {
            const x = (lng - TEPHRA_LNG) * MILES_TO_PIXELS * Math.cos(TEPHRA_LAT * Math.PI / 180);
            const y = -(lat - TEPHRA_LAT) * MILES_TO_PIXELS;
            return { x: x + 500, y: y + 500 };
        };

        const herbData = [
            {
                id: 1,
                name: "Spearmint Leaves",
                lat: positions[0].lat,
                lng: positions[0].lng,
                image: "spearmint.jpg",
                eventUrl: "https://eventbrite.com/spearmint",
                nextEvent: "2025-03-01T15:00:00"
            },
            // ... Copy your full herbData array here from your original file
        ];

        const CountdownClock = ({ nextEvent }) => {
            const [timeLeft, setTimeLeft] = useState(null);

            useEffect(() => {
                const calculateTimeLeft = () => {
                    const difference = new Date(nextEvent) - new Date();
                    if (difference > 0) {
                        return {
                            days: Math.floor(difference / (1000 * 60 * 60 * 24)),
                            hours: Math.floor((difference / (1000 * 60 * 60)) % 24),
                            minutes: Math.floor((difference / 1000 / 60) % 60)
                        };
                    }
                    return null;
                };

                setTimeLeft(calculateTimeLeft());
                const timer = setInterval(() => {
                    setTimeLeft(calculateTimeLeft());
                }, 60000);

                return () => clearInterval(timer);
            }, [nextEvent]);

            if (!timeLeft) return <div>Event Past</div>;

            return (
                <div className="flex items-center gap-2 text-sm">
                    <Clock className="w-4 h-4" />
                    <span>
                        {timeLeft.days}d {timeLeft.hours}h {timeLeft.minutes}m
                    </span>
                </div>
            );
        };

        const HerbIcon = ({ herb, isHovered, onClick }) => {
            const { x, y } = convertToXY(herb.lat, herb.lng);
            
            return (
                <g 
                    transform={`translate(${x},${y})`}
                    onClick={onClick}
                    className="cursor-pointer"
                >
                    <circle
                        r="25"
                        fill={isHovered ? "rgba(255,255,255,0.9)" : "rgba(144,238,144,0.9)"}
                        className="transition-all duration-300"
                    />
                    {isHovered ? (
                        <foreignObject x="-45" y="-45" width="90" height="90">
                            <div className="flex items-center justify-center h-full">
                                <CountdownClock nextEvent={herb.nextEvent} />
                            </div>
                        </foreignObject>
                    ) : (
                        <image
                            href={herb.image}
                            x="-20"
                            y="-20"
                            width="40"
                            height="40"
                            className="transition-opacity duration-300"
                        />
                    )}
                    <text
                        y="40"
                        textAnchor="middle"
                        className="text-xs font-semibold fill-current"
                    >
                        {herb.name}
                    </text>
                </g>
            );
        };

        const HerbMap = () => {
            const [hoveredId, setHoveredId] = useState(null);

            return (
                <div className="w-full h-screen bg-gray-100 p-4">
                    <svg
                        viewBox="0 0 1000 1000"
                        className="w-full h-full bg-white rounded-lg shadow-lg"
                    >
                        {/* 5 mile radius circle */}
                        <circle
                            cx="500"
                            cy="500"
                            r={MILES_TO_PIXELS * 5}
                            fill="none"
                            stroke="#ddd"
                            strokeWidth="2"
                            strokeDasharray="5,5"
                        />
                        
                        {/* Tephra ICA marker */}
                        <circle
                            cx="500"
                            cy="500"
                            r="8"
                            fill="red"
                        />
                        <text
                            x="500"
                            y="480"
                            textAnchor="middle"
                            className="text-sm font-bold fill-current"
                        >
                            Tephra ICA
                        </text>

                        {/* Herb markers */}
                        {herbData.map(herb => (
                            <HerbIcon
                                key={herb.id}
                                herb={herb}
                                isHovered={hoveredId === herb.id}
                                onClick={() => window.open(herb.eventUrl, '_blank')}
                                onMouseEnter={() => setHoveredId(herb.id)}
                                onMouseLeave={() => setHoveredId(null)}
                            />
                        ))}
                    </svg>
                </div>
            );
        };

        ReactDOM.render(<HerbMap />, document.getElementById('root'));
    </script>
</body>
</html>
