<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herb Map</title>
    <!-- Debug message to confirm page load -->
    <script>console.log('Page starting to load...');</script>
    
    <!-- Load React -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.22.17/babel.min.js"></script>
    
    <!-- Load Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Add error handling -->
    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Error: ' + msg + '\nURL: ' + url + '\nLine: ' + lineNo + '\nColumn: ' + columnNo + '\nError object: ' + JSON.stringify(error));
            return false;
        };
        console.log('Error handler installed');
    </script>
</head>
<body>
    <!-- Add visible error container -->
    <div id="error-container" style="display:none; color:red; padding:20px;"></div>
    <div id="root"></div>

    <script type="text/babel">
        console.log('Starting Babel script...');
        
        try {
            // Check if React is loaded
            if (!window.React) throw new Error('React not loaded');
            if (!window.ReactDOM) throw new Error('ReactDOM not loaded');
            
            const { useState, useEffect } = React;
            console.log('React hooks imported');

            const TEPHRA_LAT = 38.9586;
            const TEPHRA_LNG = -77.3570;
            const MILES_TO_PIXELS = 100;

            const generateCoordinates = (centerLat, centerLng, radiusMiles, count) => {
                const coordinates = [];
                for (let i = 0; i < count; i++) {
                    const angle = (i / count) * 2 * Math.PI;
                    const radius = (radiusMiles * (i + 1)) / count;
                    const lat = centerLat + (radius / 69) * Math.cos(angle);
                    const lng = centerLng + (radius / (69 * Math.cos(centerLat * Math.PI / 180))) * Math.sin(angle);
                    coordinates.push({ lat, lng });
                }
                return coordinates;
            };

            console.log('Helper functions defined');

            const positions = generateCoordinates(TEPHRA_LAT, TEPHRA_LNG, 4.5, 19);
            console.log('Positions generated:', positions.length);

            const convertToXY = (lat, lng) => {
                const x = (lng - TEPHRA_LNG) * MILES_TO_PIXELS * Math.cos(TEPHRA_LAT * Math.PI / 180);
                const y = -(lat - TEPHRA_LAT) * MILES_TO_PIXELS;
                return { x: x + 500, y: y + 500 };
            };

            // Add test herb data
            const herbData = [
                {
                    id: 1,
                    name: "Arnica",
                    lat: positions[0].lat,
                    lng: positions[0].lng,
                    image: "arnica.jpg",
                    eventUrl: "#",
                    nextEvent: "2025-03-01T15:00:00"
                }
            ];

            console.log('Initial herb data loaded');

            const App = () => {
                console.log('App component rendering');
                return <div className="p-4">Loading map...</div>;
            };

            const rootElement = document.getElementById('root');
            if (!rootElement) throw new Error('Root element not found');

            const root = ReactDOM.createRoot(rootElement);
            root.render(<App />);
            console.log('Initial render complete');

        } catch (error) {
            console.error('Error in main script:', error);
            const errorContainer = document.getElementById('error-container');
            if (errorContainer) {
                errorContainer.style.display = 'block';
                errorContainer.innerHTML = `Error loading application: ${error.message}`;
            }
        }
    </script>
</body>
</html>
